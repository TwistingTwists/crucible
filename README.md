# Crucible


**Design and Potential Approach:** Crucile has an Elixir-facing interface for Crucible (rust). It will provide a user-friendly API for analyzing JavaScript/TypeScript code and extracting relevant information.

A potential approach for Igniter JS involves:

1. Accepting JavaScript/TypeScript source code as input.
2. Calling the appropriate functions in the Crucible Rust library to perform the analysis.
3. Processing the results from the Rust library and returning them in a format suitable for Elixir consumption.


#### How to get started using this repo?

1. if you want to develop / test a new feature

- Clone the repo. 
- design a test case - think about input / output. See: `.iex.exs`
- create the binding on the elixir side : See `native.ex`
- create a function that is tagged as `rustler:nif` in `native/crucible/src/lib.rs`
- open terminal and run `iex -S mix run --no-halt` 


## Crucible Rust Library

**Role:** The Crucible Rust library provides the core static analysis engine. It leverages the `oxc` JavaScript parser to build an Abstract Syntax Tree (AST) and perform semantic analysis. This allows Crucible to understand the structure and meaning of the code, enabling it to identify specific patterns and symbols.

**Design:** The Rust library exposes functions to Elixir via Rustler.  Key components include:

* **Parsing:** Uses `oxc_parser` to parse source code into an AST.  Handles errors gracefully and returns a structured `ParseResult`.
* **Semantic Analysis:** Leverages `oxc_semantic` to build a symbol table and scope tree. This enables querying for specific symbols and their properties.
* **Symbol Lookup:** Provides functions like `symbol_names` and `has_hooks` to retrieve symbol information from the AST.
* **Import Analysis:**  Analyzes import statements to resolve dependencies and identify the source of imported symbols.

### Approach to parsing Javascript using Rust. 

TL;DR : First attempt is being made to generate the AST on the rust side and create binding functions to manipulate the AST from Elixir. The AST itself is held in Rust but a pointer to it is available in elixir. 

##### What has not been figured out yet?

How to keep the pass around the entire AST between elixir and Rust. The issue arises because the AST generated by oxc_parser is not thread safe. I've tried Mutex but failed. 
This is an ongoing effort. 

Meanwhile, there are a few modules which can be used at the moment. 